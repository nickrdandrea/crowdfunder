<h1><%= @project.title %></h1>

<p><%= @project.description %></p>
<p>Goal: <%= number_to_currency(@project.goal) %></p>
<p>Fundraising starts: <%= @project.start_date.strftime("%A %b %d %Y") %></p>
<p>Deadline: <%= @project.end_date.strftime("%A %b %d %Y") %></p>

<% if @project.image.present? %>
  <%= image_tag @project.image %>
<% end %>

<% if @project.pledges.pluck(:user_id).include?(current_user.id) && @project.user_id != current_user.id %>
  <h3>Sweet you already donated!</h3>
<% elsif @project.user_id == current_user.id %>
  <h3>Sorry owners can't donate :(</h3>
<% else %>
  <h3>It would be awesome if you could donate!</h3>
<% end %>

<% if @project.user_id == current_user.id %>
  <h2>New Update</h2>
  <%= form_for @update do |f| %>
    <p><%= f.label :title %></p>
    <p><%= f.text_field :title %></p>
    <p><%= f.label :description %></p>
    <p><%= f.text_area :description %></p>
    <%= f.hidden_field :project_id, value: @project.id %>
    <p><%= f.submit "Update" %></p>
  <% end %>
<% end %>

<% if !@project.updates.empty? %>
  <h2>Updates</h2>
  <% @project.updates.limit(10).each do |update| %>
    <p><%= update.title %></p>
    <p><%= update.description %></p>
  <% end %>
<% end %>

<% if @project.pledges.pluck(:user_id).include?(current_user.id) && @project.user_id != current_user.id %>
  <h2>Add a comment!</h2>
  <%= form_for @comment do |f| %>
    <p><%= f.label :description %></p>
    <p><%= f.text_area :description %></p>
    <%= f.hidden_field :project_id, value: @project.id %>
    <%= f.hidden_field :user_id, value: current_user.id %>
    <%= f.hidden_field :user_first_name, value: current_user.first_name %>
    <p><%= f.submit "Comment!" %></p>
  <% end %>
<% end %>

<% if !@project.comments.empty? %>
  <h2>Comments</h2>
  <% @project.comments.limit(5).each do |comment| %>
    <p><%= comment.user.first_name %></p>
    <p><%= comment.description %></p>
  <% end %>
<% end %>

<h2>Rewards</h2>
<% @project.rewards.each do |reward| %>
  <p><%= number_to_currency(reward.dollar_amount) %></p>
  <p><%= reward.description %></p>
  <% if @project.user_id != current_user.id %>
    <%= form_for [reward, reward.pledges.new] do |f| %>
      <%= f.number_field :dollar_amount, value: reward.dollar_amount, step: 0.01 %>
      <%= f.submit "Pledge" %>
    <% end %>
  <% end %>

<% end %>
